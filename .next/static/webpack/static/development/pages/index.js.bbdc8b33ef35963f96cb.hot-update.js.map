{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.bbdc8b33ef35963f96cb.hot-update.js","sources":["webpack:///./components/Messenger.js"],"sourcesContent":["import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport io from 'socket.io-client';\r\nimport { addMessage } from '../actions/message';\r\nimport { addHouse } from '../actions/message';\r\nimport Message from './Message';\r\nimport NavBar from './NavBar';\r\n\r\nconst generateName = () => {\r\n  const getRandomInt = (min, max) =>\r\n    Math.floor(Math.random() * (max - min)) + min;\r\n  const firstName = [\r\n    'Jack',\r\n    'Steven',\r\n    'Brian',\r\n    'Marc',\r\n    'Drew',\r\n    'Stephanie',\r\n    'Daniel',\r\n    'James',\r\n    'Spencer',\r\n    'Caitlin',\r\n    'Jackie',\r\n    'Julius',\r\n    'Patrick',\r\n  ];\r\n  const lastName = [\r\n    'Li',\r\n    'Chung',\r\n    'Tiosejo',\r\n    'Louie',\r\n    'Curtis',\r\n    'Sockwell',\r\n    'Jiang',\r\n    'Bykowsky',\r\n    'Detro',\r\n    'Chen',\r\n    'Sea',\r\n    'Doyle',\r\n  ];\r\n  const name =\r\n    firstName[getRandomInt(0, firstName.length)] +\r\n    ' ' +\r\n    lastName[getRandomInt(0, lastName.length)];\r\n  return name\r\n};\r\n\r\nclass Messenger extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      text: '',\r\n      messages: [],\r\n      username: generateName(),\r\n      updated: false,\r\n      currentConvo: '',\r\n      friends: new Set(),\r\n      currentView: 'messenger'\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.scrollToBottom();\r\n    if (!this.state.messages.length && !this.state.updated) {\r\n      this.setState(state => {\r\n        this.props.messages.forEach(msg => {\r\n          state.friends.add(msg.username);\r\n        });\r\n        return state;\r\n      });\r\n      const filtered = this.state.currentConvo !== '' ? this.props.messages.filter(message => (message.username === this.state.currentConvo)) : this.props.messages;\r\n      this.setState({ messages: filtered, updated: true })\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.socket = io('http://localhost:3000');\r\n    this.socket.on('message', this.handleMessage);\r\n    setTimeout(this.scrollToBottom, 100);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.socket.off('message', this.handleMessage);\r\n    this.socket.close()\r\n  }\r\n\r\n  handleMessage = message => {\r\n    this.setState(state => state.friends.add(message.username));\r\n    this.setState(state => ({ messages: state.messages.concat(message) }));\r\n    this.props.addMessage(message.text, message.username, message.created_at)\r\n  };\r\n\r\n  getCurrentConvo = otherUser => {\r\n\r\n    this.setState(state => {\r\n      const filtered = this.props.messages.filter(message => (message.username === otherUser));\r\n      return {\r\n        currentConvo: otherUser,\r\n        messages: filtered,\r\n      }\r\n    });\r\n  };\r\n\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n\r\n    if (this.state.text !== '') {\r\n      const message = {\r\n        created_at: new Date().getTime(),\r\n        username: this.state.username,\r\n        text: this.state.text,\r\n      };\r\n\r\n      this.socket.emit('message', message);\r\n\r\n      this.props.addMessage(\r\n        this.state.text,\r\n        this.state.username,\r\n        message.created_at,\r\n      );\r\n      this.setState(state => ({\r\n        text: '',\r\n        messages: this.state.messages.concat(message),\r\n      }))\r\n    }\r\n\r\n  };\r\n\r\n  changeToHomeView = () => {\r\n    //TODO change this to routing? if so remove currentView from state\r\n    this.setState({currentView: 'browse'})\r\n  };\r\n\r\n  changeToMessageView = () => {\r\n    //TODO remove this with above function\r\n    this.setState({currentView: 'messenger'})\r\n  };\r\n\r\n  scrollToBottom = () => {\r\n    if (this.el) {\r\n      this.el.scrollIntoView({ behavior: 'instant' })\r\n    }\r\n  };\r\n\r\n  handleChange = e => {\r\n    this.setState({ username: e.target.value })\r\n  };\r\n\r\n  render() {\r\n    const sameUser = (msg, i, arr) => {\r\n      return i > 0 && msg.username === arr[i - 1].username\r\n    };\r\n\r\n    return (\r\n      <React.Fragment>\r\n\r\n        <input\r\n          type=\"text\"\r\n          onChange={this.handleChange}\r\n          placeholder={'enter username'}\r\n        />\r\n        <div className=\"mdl-card mdl-shadow--2dp\" id=\"chatview\">\r\n          <NavBar\r\n            getConvo={this.getCurrentConvo}\r\n            friends={[...this.state.friends]}\r\n            changeHome={this.changeToHomeView}\r\n            changeMessage={this.changeToMessageView}\r\n            currentView={this.state.currentView}\r\n          />\r\n          {this.state.currentView === 'browser' && <ul>Browse Homes</ul>}\r\n          {this.state.currentView === 'messenger' && <ul>\r\n            {this.state.messages.map((message, i, array) => (\r\n              <Message\r\n                key={i}\r\n                message={message}\r\n                username={this.state.username}\r\n                firstMessage={sameUser(message, i, array)}\r\n              />\r\n            ))}\r\n            <div\r\n              ref={el => {\r\n                this.el = el;\r\n              }}\r\n            />\r\n          </ul>}\r\n          <form onSubmit={this.handleSubmit} autoComplete=\"off\">\r\n            <div className=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\r\n              <input\r\n                type=\"text\"\r\n                value={this.state.text}\r\n                onChange={e => this.setState({ text: e.target.value })}\r\n                className=\"mdl-textfield__input\"\r\n                id=\"message-input\"\r\n                placeholder={'Send a message'}\r\n              />\r\n              <label className=\"mdl-textfield__label\" htmlFor=\"message-input\" />\r\n            </div>\r\n            <div><button>send</button></div>\r\n          </form>\r\n          <style>{`\r\n\t\t\t\t\t\t#message-input {\r\n\t\t\t\t\t\tborder-bottom: lightgray solid 1px;\r\n\t\t\t\t\t\tborder-top: lightgray solid 1px;\r\n\t\t\t\t\t\theight: 20px;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tform {\r\n\t\t\t\t\t\t\tbackground: #fff;\r\n\t\t\t\t\t\t\tpadding: 0px 10px 0px 10px;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tul {\r\n\t\t\t\t\t\t\theight: 480px;\r\n\t\t\t\t\t\t\tmargin: 0;\r\n\t\t\t\t\t\t\tpadding: 0;\r\n\t\t\t\t\t\t\ttext-align: left;\r\n\t\t\t\t\t\t\tlist-style: none;\r\n\t\t\t\t\t\t\toverflow-y: scroll;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tul li {\r\n\t\t\t\t\t\t\tpadding: 1px;\r\n\t\t\t\t\t\t\tbackground: #FFF;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t.mdl-card {\r\n\t\t\t\t\t\t\tmargin: auto;\r\n\t\t\t\t\t\t\ttransition: all .3s;\r\n\t\t\t\t\t\t\ttransform: translateY(100px);\r\n              height: 500px;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t.mdl-textfield {\r\n\t\t\t\t\t\t\tpadding: 28px 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t.timestamp{\r\n\t\t          font-size:10px;\r\n\t\t          font-weight: 300;\r\n\t\t          color: transparent;\r\n\t\t          margin: 3px;\r\n\t          }\r\n\t          li:hover .my-timestamp {\r\n\t\t          color: black;\r\n\t\t          transition: color .8s;\r\n\t          }\r\n\t          li:hover .timestamp {\r\n\t\t          color: black;\r\n\t\t          transition: color .8s;\r\n\t          }\r\n\t        .my-message {\r\n\t\t        display: inline-block;\r\n\t\t        background: #00e34d;\r\n\t\t        color: white;\r\n\t\t        border-radius: 10px;\r\n\t\t        padding: 7px;\r\n\t\t        max-width: 50%;\r\n\t\t        word-wrap: break-word;\r\n\t\t        clear: right;\r\n\t\t        line-height: 1.25;\r\n\t        }\r\n\t        .your-message {\r\n\t\t        display: inline-block;\r\n\t\t        background: #E5E5EA;\r\n\t\t        border-radius: 10px;\r\n\t\t        padding: 7px;\r\n\t\t        word-wrap: break-word;\r\n\t\t        max-width:70%;\r\n\t\t        line-height: 1.25;\r\n\t        }\r\n          .message-username {\r\n\t          display: block;\r\n\t          font-size: 0.8em;\r\n\t          font-weight: bold;\r\n\t          line-height: 1.5;\r\n\t          margin-left: 0.6em;\r\n          }\r\n\t\t\t\t\t`}</style>\r\n        </div>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  ({ messages, houses }) => ({ messages, houses }),\r\n  { addMessage , addHouse},\r\n)(Messenger)\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAeA;AAcA;AAIA;AACA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAuCA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AA3CA;AA8CA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAtDA;AAwDA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AACA;AAIA;AAAA;AACA;AACA;AAFA;AAAA;AAIA;AAEA;AACA;AA/EA;AAiFA;AACA;AAAA;AAAA;AACA;AACA;AApFA;AAsFA;AACA;AAAA;AAAA;AACA;AACA;AAzFA;AA2FA;AACA;AAAA;AAAA;AACA;AACA;AACA;AA/FA;AAiGA;AAAA;AAAA;AACA;AACA;AAjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAFA;AAWA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;;;AAgEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AAHA;AAKA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AASA;AAEA;AACA;AACA;AACA;AAJA;AADA;AASA;AACA;AACA;AAHA;AAMA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AANA;AAQA;AAAA;AAAA;AAgFA;;;;AApOA;AACA;AAsOA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;;;;A","sourceRoot":""}